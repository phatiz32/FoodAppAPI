<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Create Food Item</title>
</head>
<body>
  <h2>Th√™m m√≥n ƒÉn m·ªõi</h2>

  <form id="createForm">
    <label>T√™n m√≥n:
      <input type="text" name="name" required />
    </label><br />

    <label>M√¥ t·∫£:
      <textarea name="description" required></textarea>
    </label><br />

    <label>Gi√°:
      <input type="number" step="0.01" name="price" required />
    </label><br />

    <label>Tr·∫°ng th√°i:
      <select name="isAvailable">
        <option value="true">C√≤n b√°n</option>
        <option value="false">Ng∆∞ng b√°n</option>
      </select>
    </label><br />

    <label>Lo·∫°i m√≥n:
      <select name="categoryId" id="categorySelect" required>
        <option value="">-- Ch·ªçn lo·∫°i m√≥n --</option>
      </select>
    </label><br />

    <label>·∫¢nh:
      <input type="file" name="image" accept="image/*" />
    </label><br />

    <button type="submit">T·∫°o m√≥n</button>
  </form>

  <div id="result"></div>

  <script>
    // üü¢ Load danh s√°ch category
    async function loadCategories() {
      const res = await fetch("http://localhost:5001/api/category");
      const data = await res.json();

      const select = document.getElementById("categorySelect");
      select.innerHTML = '<option value="">-- Ch·ªçn lo·∫°i m√≥n --</option>';

      data.forEach(cat => {
        const opt = document.createElement("option");
        opt.value = cat.id;
        opt.textContent = cat.name;
        select.appendChild(opt);
      });
    }

    loadCategories(); // g·ªçi khi trang load

    // üîÑ X·ª≠ l√Ω g·ª≠i form t·∫°o m√≥n
    document.getElementById("createForm").addEventListener("submit", async function (e) {
      e.preventDefault();

      const form = e.target;
      const formData = new FormData(form);

      const response = await fetch("http://localhost:5001/api/fooditem", {
        method: "POST",
        body: formData
      });

      const result = document.getElementById("result");

      if (response.ok) {
        const data = await response.json();
        result.innerHTML = `<p style="color:green;">T·∫°o th√†nh c√¥ng!</p><pre>${JSON.stringify(data, null, 2)}</pre>`;
        form.reset();
      } else {
        const error = await response.text();
        result.innerHTML = `<p style="color:red;">L·ªói: ${error}</p>`;
      }
    });
  </script>
</body>
</html>
