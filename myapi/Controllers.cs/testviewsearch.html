<!DOCTYPE html>
<html>
<head>
    <title>Food Items</title>
    <meta charset="UTF-8" />
</head>
<body>
    <h1>Danh s√°ch m√≥n ƒÉn</h1>

    <div style="margin-bottom: 10px;">
        <label>T√™n m√≥n ƒÉn:</label>
        <input type="text" id="searchInput" placeholder="Nh·∫≠p t√™n m√≥n ƒÉn" />

        <label style="margin-left: 10px;">Lo·∫°i m√≥n:</label>
        <select id="categorySelect">
            <option value="">-- T·∫•t c·∫£ lo·∫°i --</option>
        </select>

        <button onclick="loadData()" style="margin-left: 10px;">T√¨m</button>
    </div>

    <table border="1" cellpadding="5" cellspacing="0">
        <thead>
            <tr>
                <th>T√™n</th>
                <th>M√¥ t·∫£</th>
                <th>Gi√°</th>
                <th>C√≤n b√°n</th>
                <th>Lo·∫°i</th>
                <th>·∫¢nh</th>
            </tr>
        </thead>
        <tbody id="foodTable">
        </tbody>
    </table>

    <script>
        const baseApi = "http://localhost:5001/api"; // üîß ƒê·ªïi l·∫°i n·∫øu kh√°c

        async function loadCategories() {
            try {
                const res = await fetch(`${baseApi}/category`);
                const data = await res.json();
                const categorySelect = document.getElementById("categorySelect");

                data.forEach(c => {
                    const opt = document.createElement("option");
                    opt.value = c.id;
                    opt.textContent = c.name;
                    categorySelect.appendChild(opt);
                });
            } catch (err) {
                console.error("Kh√¥ng th·ªÉ t·∫£i danh s√°ch lo·∫°i:", err);
            }
        }

        async function loadData() {
            const search = document.getElementById("searchInput").value;
            const categoryId = document.getElementById("categorySelect").value;

            let url = `${baseApi}/fooditem?`;
            if (search) url += `searchName=${encodeURIComponent(search)}&`;
            if (categoryId) url += `categoryId=${categoryId}&`;
            url += `pageNumber=1&pageSize=20`;

            try {
                const response = await fetch(url);
                const data = await response.json();

                const table = document.getElementById("foodTable");
                table.innerHTML = "";

                if (data.length === 0) {
                    table.innerHTML = "<tr><td colspan='6'>Kh√¥ng c√≥ m√≥n n√†o ph√π h·ª£p</td></tr>";
                    return;
                }

                data.forEach(item => {
                    const row = `<tr>
                        <td>${item.name}</td>
                        <td>${item.description}</td>
                        <td>${item.price}</td>
                        <td>${item.isAvailable ? 'C√≥' : 'H·∫øt'}</td>
                        <td>${item.categoryName}</td>
                         ${item.imageUrl ? `<img src="http://localhost:5001/uploads/${item.imageUrl}" width="200"/>` : "<p>Kh√¥ng c√≥ h√¨nh ·∫£nh</p>"}
                    </tr>`;
                    table.innerHTML += row;
                });
            } catch (err) {
                console.error("L·ªói khi t·∫£i danh s√°ch m√≥n ƒÉn:", err);
            }
        }

        // Load t·∫•t c·∫£ khi kh·ªüi ƒë·ªông
        loadCategories().then(loadData);
    </script>
</body>
</html>
